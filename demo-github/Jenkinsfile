pipeline {
    agent any

    parameters {
        string(name: 'DOCKER_USERNAME', defaultValue: 'evanblaise', description: 'Docker Hub username')
        string(name: 'DOCKER_PASSWORD', defaultValue: '', description: 'Docker Hub password or token')
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Build Docker Image') {
            steps {
                script {
                    docker.build('evanblaise/demo-github-app:latest', '-f demo-github/Dockerfile demo-github')
                }
            }
        }

        stage('Docker Login & Push') {
            steps {
                script {
                    sh """
                      echo '${params.DOCKER_PASSWORD}' | docker login -u '${params.DOCKER_USERNAME}' --password-stdin
                      docker push evanblaise/demo-github-app:latest
                    """
                }
            }
        }
    }
}
